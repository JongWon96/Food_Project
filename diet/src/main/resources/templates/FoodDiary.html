<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food Diary</title>
<link rel="stylesheet" href="styles.css">
<script src="scripts.js" defer></script>
<script>
function searchFoodDetail(foodNameId, foodIdFieldId, resultId) {
    const foodName = document.getElementById(foodNameId).value;
    if (!foodName) {
        alert("음식 이름을 입력하세요!");
        return;
    }
    fetch(`/food-diary/search/food-detail?name=${encodeURIComponent(foodName)}`)
        .then(response => response.json()) // JSON으로 응답 받기
        .then(data => {
            if (data.id) {
                document.getElementById(foodIdFieldId).value = data.id; // 숨겨진 필드에 ID 설정
                document.getElementById(resultId).textContent = `음식: ${data.name}, 칼로리: ${data.kcal}`;
            } else {
                alert("음식을 찾을 수 없습니다.");
            }
        })
        .catch(error => {
            alert("오류가 발생했습니다: " + error.message);
        });
}
</script>
</head>
<body>
	<header> </header>
	<main>
		<section class="food-diary">
			<h1>마이 푸드 다이어리</h1>
			<p>
				<span id="day-name" th:text="${dayName}"></span> <span
					id="diary-date" th:text="${selectedDate}"></span>
			</p>
<div class="meal-section">
    <h2>아침 식사</h2>
    <form action="/food-diary/add" method="post">
        <input type="hidden" name="date" th:value="${selectedDate}">
        <input type="hidden" name="dmeal" value="1">

        <!-- 음식 검색 -->
        <label for="foodName1">음식 이름:</label>
        <input type="text" id="foodName1" placeholder="음식 이름 입력">
        <button type="button" onclick="searchFoodDetail('foodName1', 'foodId1', 'foodDetailResult1')">검색</button>

        <!-- 검색된 음식 ID 저장 -->
        <input type="hidden" id="foodId1" name="foodId">

        <div>
            <!-- 검색 결과 표시 -->
            <p id="foodDetailResult1"></p>
        </div>
        <button type="submit">항목 추가하기</button>
    </form>
</div>

<div class="meal-section">
    <h2>점심 식사</h2>
    <form action="/food-diary/add" method="post">
        <input type="hidden" name="date" th:value="${selectedDate}">
        <input type="hidden" name="dmeal" value="2">

        <!-- 음식 검색 -->
        <label for="foodName2">음식 이름:</label>
        <input type="text" id="foodName2" placeholder="음식 이름 입력">
        <button type="button" onclick="searchFoodDetail('foodName2', 'foodDetailResult2')">검색</button>

        <div>
            <!-- 검색 결과 표시 -->
            <p id="foodDetailResult2"></p>
        </div>
        <button type="submit">항목 추가하기</button>
    </form>
</div>
<div class="meal-section">
    <h2>저녁 식사</h2>
    <form action="/food-diary/add" method="post">
        <input type="hidden" name="date" th:value="${selectedDate}">
        <input type="hidden" name="dmeal" value="3">

        <!-- 음식 검색 -->
        <label for="foodName3">음식 이름:</label>
        <input type="text" id="foodName3" placeholder="음식 이름 입력">
        <button type="button" onclick="searchFoodDetail('foodName3', 'foodDetailResult3')">검색</button>

        <div>
            <!-- 검색 결과 표시 -->
            <p id="foodDetailResult3"></p>
        </div>
        <button type="submit">항목 추가하기</button>
    </form>
</div>
<div class="meal-section">
    <h2>간식/기타</h2>
    <form action="/food-diary/add" method="post">
        <input type="hidden" name="date" th:value="${selectedDate}">
        <input type="hidden" name="dmeal" value="4">

        <!-- 음식 검색 -->
        <label for="foodName4">음식 이름:</label>
        <input type="text" id="foodName4" placeholder="음식 이름 입력">
        <button type="button" onclick="searchFoodDetail('foodName4', 'foodDetailResult4')">검색</button>

        <div>
            <!-- 검색 결과 표시 -->
            <p id="foodDetailResult4"></p>
        </div>
        <button type="submit">항목 추가하기</button>
    </form>
</div>
		</section>
		<section class="daily-overview">
			<h2>일일 개요</h2>
			<div>
				<p>칼로리 분석:</p>
				<ul>
					<li>탄수화물: 0%</li>
					<li>지방: 0%</li>
					<li>단백질: 0%</li>
				</ul>
			</div>
		</section>
	</main>
</body>
</html>
