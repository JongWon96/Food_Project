<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ìƒì„¸</title>
    <link rel="stylesheet" href="/css/boardDetail.css">
    <script th:inline="javascript">
        // ëŒ“ê¸€ ì‘ì„± ë²„íŠ¼ í´ë¦­ ì‹œ textarea í† ê¸€
       function toggleCommentForm() {
    var commentForm = document.getElementById("commentForm");
    var submitButton = document.getElementById("submitButton");
    var commentText = document.getElementsByName("ccontent")[0];

    if (commentForm.style.display === "none" || commentForm.style.display === "") {
        // í¼ í‘œì‹œ
        commentForm.style.display = "block";
        submitButton.innerText = "ëŒ“ê¸€ ì‘ì„± ì™„ë£Œ"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    } else {
        // í¼ì´ ì´ë¯¸ í‘œì‹œëœ ìƒíƒœì—ì„œ ë‚´ìš©ì´ ë¹„ì–´ ìˆëŠ” ê²½ìš° í¼ ìˆ¨ê¸°ê¸°
        if (commentText.value.trim() === "") {
            commentForm.style.display = "none";
            submitButton.innerText = "ëŒ“ê¸€ ì‘ì„±"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        } else {
            // ë‚´ìš©ì´ ìˆìœ¼ë©´ í¼ì„ ì œì¶œ
            commentForm.submit();
        }
    }
}

     // ëŒ“ê¸€ ìˆ˜ì • í¼ì„ í† ê¸€í•˜ëŠ” í•¨ìˆ˜
        function toggleCommentEditForm(cuid) {
           console.log('cuid', cuid);
        var commentEditForm = document.getElementById("commentEditForm-" + cuid);
        console.log('commentEditForm', commentEditForm);
            // í•´ë‹¹ ëŒ“ê¸€ì˜ ìˆ˜ì • í¼ì´ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ë³´ì´ë„ë¡ í•˜ê³ , ë³´ì´ë©´ ìˆ¨ê¸°ë„ë¡ ì„¤ì •
            if (commentEditForm.style.display === "none" || commentEditForm.style.display === "") {
                commentEditForm.style.display = "block";  // í¼ ë³´ì´ê¸°
            } else {
                commentEditForm.style.display = "none";  // í¼ ìˆ¨ê¸°ê¸°
            }
        }



        // ì‹ ê³  ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì°½ ì—´ê¸°
        function openReportModal() {
            document.getElementById("reportModal").style.display = "block";
        }

        // ëª¨ë‹¬ ì°½ ë‹«ê¸°
        function closeReportModal() {
            document.getElementById("reportModal").style.display = "none";
        }

        // ì‹ ê³  ì´ìœ  ì œì¶œ (ì´ì œ ì´ìœ  ì—†ì´ ì‹ ê³ )
        function submitReport() {
            var form = document.getElementById("reportForm");
            form.submit();  // í¼ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ì—¬ ì‹ ê³  ì²˜ë¦¬
        }

        // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ì‹œì§€ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œ
        const likeButton = document.getElementById("likeButton");
        const likeMessage = document.getElementById("likeMessage");

        if (likeButton.disabled) {
            openLikeErrorModal("ì´ë¯¸ ì´ ê²Œì‹œê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ê±°ë‚˜ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        }

        function openLikeErrorModal(message) {
            const modal = document.getElementById("likeErrorModal");
            const errorMessage = document.getElementById("likeErrorMessage");
            errorMessage.innerText = message;
            modal.style.display = "block"; // ëª¨ë‹¬ ì—´ê¸°
        }

        // ëª¨ë‹¬ì„ ë‹«ëŠ” í•¨ìˆ˜
        function closeLikeErrorModal() {
            const modal = document.getElementById("likeErrorModal");
            modal.style.display = "none"; // ëª¨ë‹¬ ë‹«ê¸°
        }
    </script>
</head>
<body>

<header>
    <h1>ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</h1>
    <a href="/main">í™ˆ /</a>
    <a href="/mypage">ë§ˆì´í˜ì´ì§€ /</a>
    <a th:if="${loginUser != null}" href="/Food_diary">ë‚˜ì˜ ë‹¤ì´ì–´ë¦¬ /</a>
    <a href="/Food">ìš”ë¦¬ /</a>
    <a href="/Recomand">ì˜¤ëŠ˜ì˜ ì¶”ì²œ /</a>
    <a href="/boards">ê²Œì‹œíŒ /</a>
    <a th:if="${loginUser == null}" href="/login">ë¡œê·¸ì¸ </a>
    <!-- ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ -->
    <form id="logoutForm" th:action="@{/board/logout}" method="post" style="display:inline;">
        <button type="submit" th:if="${loginUser != null}">
            ë¡œê·¸ì•„ì›ƒ (<span th:text="${loginUser}"></span>)
        </button>
    </form>

    <!-- ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ -->
    <form id="adminLogoutForm" th:action="@{/admin/logout}" method="post" style="display:inline;">
        <button type="submit" th:if="${admininfoUser != null}">
            ë¡œê·¸ì•„ì›ƒ (<span th:text="${admininfoUser}"></span>)
        </button>
    </form>
</header>

<h1 th:text="${board.btitle}"></h1>
<p>ì‘ì„±ì: <span th:text="${board.author.uname}"></span></p>

<!-- ê²Œì‹œê¸€ ë‚´ìš© -->
<div class="board-bcontent">
    <p th:text="${board.bcontent}"></p>
    <img th:if="${board.bimg != null}" th:src="@{${imagePath}}" alt="ì´ë¯¸ì§€ ì—ëŸ¬" style="width: 100%; max-width: 600px; height: auto;">
</div>

<p>ì‘ì„±ì¼: <span th:text="${#dates.format(board.bcreateAt, 'yyyy-MM-dd HH:mm')}"></span></p>


<!-- ê²Œì‹œê¸€ ì‹ ê³  ë²„íŠ¼ -->
<button onclick="openReportModal()">ê²Œì‹œê¸€ ì‹ ê³ </button>

<!-- ì‹ ê³  ëª¨ë‹¬ ì°½ -->
<div id="reportModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeReportModal()">&times;</span>
        <h3>ê²Œì‹œê¸€ì„ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
        <button onclick="submitReport()">ì‹ ê³  ì™„ë£Œ</button>
    </div>
</div>


<!-- ì¢‹ì•„ìš” ë²„íŠ¼ ì„¹ì…˜ -->
<div class="like-section">
    <!-- ì¢‹ì•„ìš” ìˆ˜ í‘œì‹œ -->

    <form    th:action="@{/board_like/{buid}(buid=${board.buid})}" method="POST" id="likeForm">
        <button type="submit" id="likeButton"
                ${session.getAttribute('likedBoard' + board.buid) != null ? 'disabled' : ''}>
        <span>ğŸ‘</span> ì¢‹ì•„ìš” <span th:text=${board.blikecnt}></span>
        </button>
    </form>

    <!-- ì¢‹ì•„ìš” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œ -->
    <div id="likeErrorModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeLikeErrorModal()">&times;</span>
            <p id="likeErrorMessage"></p>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹ˆê±°ë‚˜ ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ë‹¤ë©´ ë©”ì‹œì§€ í‘œì‹œ -->
    <div id="likeMessage" style="color: red; font-weight: bold;"></div>
</div>


</div>




<!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
<h3>ëŒ“ê¸€</h3>
<ul>
    <th:block th:each="comment : ${comments}">
        <li>
            <span th:text="${comment.cuid}"></span>
            <span th:text="${comment.author.uname}"></span>:
            <span th:text="${comment.ccontent}"></span>

            <!-- ëŒ“ê¸€ ìˆ˜ì • ë²„íŠ¼ -->
            <button type="button" th:onclick="'toggleCommentEditForm(' + ${comment.cuid} + ')'" >ëŒ“ê¸€ ìˆ˜ì •</button>

            <!-- ëŒ“ê¸€ ìˆ˜ì • í¼ -->
            <form th:id="'commentEditForm-' + ${comment.cuid}"
                  th:action="@{/comment_edit/{cuid}(cuid=${comment.cuid})}"
                  method="post" style="display:none;">
                <input type="hidden" name="cuid" th:value="${comment.cuid}" />
                <textarea name="ccontent" placeholder="ëŒ“ê¸€ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì„¸ìš”" th:text="${comment.ccontent}"></textarea>
                <button type="submit">ëŒ“ê¸€ ìˆ˜ì • ì™„ë£Œ</button>
            </form>




            <!-- ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ -->
            <form th:action="@{/comment_delete/{cuid}(cuid=${comment.cuid})}" method="post" style="display:inline;">
                <button type="submit">ëŒ“ê¸€ ì‚­ì œ</button>
            </form>
        </li>
    </th:block>
</ul>

<!-- ëŒ“ê¸€ ì‘ì„± ë²„íŠ¼ -->
<button onclick="toggleCommentForm()">ëŒ“ê¸€ ì‘ì„±</button>

<!-- ëŒ“ê¸€ ì‘ì„± í¼ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
<form id="commentForm" th:action="@{/comment/write}" method="post" style="display:none;">
    <input type="hidden" name="buid" th:value="${board.buid}">
    <textarea name="ccontent" placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
    <button type="submit" id="submitButton">ëŒ“ê¸€ ì‘ì„±</button>
</form>

<br>
<form action="/boards" method="get">
    <button type="submit" class="btn">ëª©ë¡ìœ¼ë¡œ</button>
</form>

<!-- ê²Œì‹œê¸€ ìˆ˜ì • í¼ -->
<form th:action="@{/board_edit_form/{buid}(buid=${board.buid})}" method="get">
    <button type="submit" class="btn">ê²Œì‹œê¸€ ìˆ˜ì •</button>
</form>

<!-- ê²Œì‹œê¸€ ì‚­ì œ í¼ -->
<form th:action="@{/board_delete/{buid}(buid=${board.buid})}" method="get">
    <button type="submit" class="btn">ê²Œì‹œê¸€ ì‚­ì œ</button>
</form>

<!-- ì‹ ê³  í¼ -->
<form id="reportForm" th:action="@{/board_danger/{buid}(buid=${board.buid})}" method="post" style="display:none;">
</form>

</body>
</html>
